# Queries

Queries are the core data request interface for any Meetup Web Platform app.
They are primarily generated by application Routes to indicate what data each
one needs from the API when it is active. However, they can be used for any
request to the API, and are therefore part of POST and DELETE requests as well.

At a high level, you can think of a Query as a 'tagged' API request, including
all request parameters, the endpoint URI, and any metadata properties like
feature flag requests.

## Spec

A Query is just a plain object with the following shape:

```js
{
  ref: string,
  type: string,
	endpoint: string,
  params: object,
	flags?: string[],
}
```

### `ref`

A unique string reference to the query. The `ref` is used to uniquely identify
the query _and_ uniquely assign the resulting API data to Redux state at
`state.app[ref]`.

### `type`

A one-word description of the 'data type' expected to be returned by the API
for this query. This information is used on the server to further process the
data for certain data types like `'group'` objects, which will receive special
duotone photo URLs in addition to the standard photo URLs provided by the API.

The `type` should be the same regardless of whether the returned data is an
array or a singleton.

**Examples**

- `group`
- `member`
- `event`
- `comment`
- feature-specific objects like `home`, `conversations`

### `endpoint`

The Meetup API endpoint as a URL pathname, e.g. `/members/123456`. Note that
this URL should not include any parameter placeholders like `/:urlname` - the
values should be filled in as needed.

### `params`

The parameters that should be passed to the API either in the querystring (for
GET requests) or the request body (for POST requests).

### `flags`

An array of feature flag (Runtime Flag) names that should be returned
alongside the main request.

## Usage

### Route query functions

Queries (e.g. `src/app/root/appQuery.js`) have two requirements:

1. They are assigned as _props_ of React Router `Route`s .The `query` prop can
be either a single Query function or an array
2. They are pure functions that take the Router's `renderProps` (i.e. current
URL `location` and `params` extracted from the URL) and deliver a description
of the data needed for the route they are assigned to.

Queries are essentially declarative hooks into the "side effect" of
communication with an API.

The simplest way to describe the data a route needs is by providing the following properties:

1. The type of data expected (similar to specifying the TABLE in a SQL statement)
2. The parameters that are needed to select the matching objects (similar to WHERE)
3. A keyword to distinguish this `query` from any others that might ask for similar data

For example in the `groupQuery`, the query function returns:

 ```js
{
  type: 'group',
  params: { urlname },
  ref: GROUP_REF,  // route-unique string (ideally globally-unique)
}
```

`urlname` is one of the parameters extracted from the `/:urlname/` `Route`. The only information provided to a query
function is the `renderProps` from the route, so the parameters need to be extractable from something in the URL
(including query string and hash).

It is important to note that these queries are intended to be API-agnostic - they will be sent to the application server
for translation into external API calls.


